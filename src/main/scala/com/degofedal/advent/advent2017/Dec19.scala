package com.degofedal.advent.advent2017

/**
--- Day 19: A Series of Tubes ---

Somehow, a network packet got lost and ended up here. It's trying to follow a routing diagram (your puzzle input), but it's confused about where to go.

Its starting point is just off the top of the diagram. Lines (drawn with |, -, and +) show the path it needs to take, starting by going down onto the only line connected to the top of the diagram. It needs to follow this path until it reaches the end (located somewhere within the diagram) and stop there.

Sometimes, the lines cross over each other; in these cases, it needs to continue going the same direction, and only turn left or right when there's no other option. In addition, someone has left letters on the line; these also don't change its direction, but it can use them to keep track of where it's been. For example:

     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+

Given this diagram, the packet needs to take the following path:

Starting at the only line touching the top of the diagram, it must go down, pass through A, and continue onward to the first +.
Travel right, up, and right, passing through B in the process.
Continue down (collecting C), right, and up (collecting D).
Finally, go all the way left through E and stopping at F.
Following the path to the end, the letters it sees on its path are ABCDEF.

The little packet looks up at you, hoping you can help it find the way. What letters will it see (in the order it would see them) if it follows the path? (The routing diagram is very wide; make sure you view it without line wrapping.)

  Your puzzle answer was AYRPVMEGQ.

The first half of this puzzle is complete! It provides one gold star: *

--- Part Two ---

The packet is curious how many steps it needs to go.

For example, using the same routing diagram from the example above...

     |
     |  +--+
     A  |  C
 F---|--|-E---+
     |  |  |  D
     +B-+  +--+

...the packet would go:

6 steps down (including the first line at the top of the diagram).
3 steps right.
4 steps up.
3 steps right.
4 steps down.
3 steps right.
2 steps up.
13 steps left (including the F it stops on).
This would result in a total of 38 steps.

How many steps does the packet need to go?
  */

sealed trait PipeDirection {
  def step(p: (Int,Int)): (Int,Int)
  val oposite: PipeDirection
}
case object PN extends PipeDirection{
  def step(p: (Int,Int)): (Int,Int) = (p._1 + 1 , p._2)
  override val oposite: PipeDirection = PS
}
case object PE extends PipeDirection{
  def step(p: (Int,Int)): (Int,Int) = (p._1, p._2 + 1)
  override val oposite: PipeDirection = PW
}
case object PS extends PipeDirection{
  def step(p: (Int,Int)): (Int,Int) = (p._1 - 1, p._2)
  override val oposite: PipeDirection = PN
}
case object PW extends PipeDirection{
  def step(p: (Int,Int)): (Int,Int) = (p._1, p._2 - 1)
  override val oposite: PipeDirection = PE
}

class State(var pos: (Int,Int)) {
  var dir: PipeDirection = PN
  //var pos: (Int,Int) = (0,0)
  var done: Boolean = false

  var letters = ""

  override def toString: String = s"$pos - $dir : $letters"
}

object Dec19 {

  val input = "                                       |                                                                                                                                                                 \n +-----+         +-----+ +-----+ +-----|-----+   +-+           +-----------------------------------------------------------------------------------------+ +---------+       +-+               +-+       \n |     |         |     | |     | |     |     |   | |           |                                                                                         | |         |       | |               | |       \n |     | +-------+ +---+ |     +-------------|---+ +---------------------+ +-----------------------------------------------------------------------------|-----------|---------------+         +-|---+   \n |     | |         |     |       |     |     |                 |         | |                                                                             | |         |       | |     |           |   |   \n |   +---|-------+ +-----|---+ +-------------|---+             |         | |                                           +-----Q                   +-------|-|-----+   |     +-|-|-------+         |   |   \n |   | | |       |       |   | | |     |     |   |             |         | |                                           |                         |       | |     |   |     | | |     | |         |   |   \n |   | | |       |   +---------|-|-----------|-------+         |         +-----------------------------+               +-----+                   |       | |     +-----+   | | |     | |         |   |   \n |   | | |       |   |   |   | | |     |     |   |   |         |           |                           |                     |                   |       | |         | |   | | |     | |         |   |   \n |   | | |       |   |   |   | +-+ +---------|---+   |       +-+ +-----------------------------------------------------------|-------------------|-------|-----------|-----+ | |     | | +-------|-----+ \n |   | | |       |   |   |   |     |   |     |       |       |   |         |                           |                     |                   |       | |         | |     | |     | | |       |   | | \n |   | | |       |   +---|---|-+   |   |     |       |       |   |         |                 +---------------------------------+                 |     +-------------|-|-------------+ | |       | +-+ | \n |   | | |       |       |   | |   |   |     |       |       |   |         |                 |         |                     | |                 |     | | |         | |     | |       | |       | |   | \n |   +---+       |       |   | +---|-------------+   |       |   |         |           +-----|---------|---------------------|-|-----------------|-----|-|---+   +-------------|-----------------|-|-+ | \n |     |         |       |   |     |   |     |   |   |       |   |         |           |     |         |                     | |                 |     | | | |   |   | |     | |       | |       | | | | \n |     |         |       |   +---------|-------+ |   |       | +-----------------------------|-------------------------------|-+                 |     | +---+   |   | +---+ | | +---------------|-|-+ | \n |     |         |       |         |   |     | | |   |       | | |         |           |     |         |                     |                   |     |   |     |   |     | | | |     | |       | |   | \n |     |         |       |         |   |     | | |   |       | +-----------------------|-+   |     +-------------------------|-------------------------|---|---------|-----+ | | |     | |       | |   | \n |     |         |       |         |   |     | | |   |       |   |         |           | |   |     |   |                     |                   |     |   |     |   |       | | |     | |       | |   | \n |     |     +-----------|-------------|-----|-|-------------|---+         |           | +---|-----------------------+       +-------------+     |     |   |     |   |       | | |     | |       | | +-+ \n |     |     |   |       |         |   |     | | |   |       |             |           |     |     |   |             |                     |     |     |   |     |   |       | | |     | |       | | |   \n |     |     |   |       |   +---------|-----|-|-+   |       +-------------------------------|---------------------------------------------------|-------------------|---------|-|-------+       | | |   \n |     |     |   |       |   |     |   |     | |     |                     |           |     |     |   |             |                     |     |     |   |     |   |       | | |     |         | | |   \n |     |     +---+   +-------|---------------+ | +---|---------------------------------|-----|-+   |   |             |                     | +---|-----+   |     |   |       | | |     |         | | |   \n |     |             |   |   |     |   |       | |   |                     |           |     | |   |   |             |                     | |   |         |     |   |       | | |     |         | | |   \n |     |       +-----+   |   | +-------|-------|---+ | +-------------------|-----------|-----|-|---|---------------------------------------|-|-------------------|---|-------|-|-----------------+ | |   \n |     |       |         |   | |   |   |       | | | | |                   |           |     | |   |   |             |                     | |   |         |     |   |       | | |     |           | |   \n | +-------------------------|---------|-----------|-----------------------------------|-----|-|---|---|-------------------------------------+   |         |     |   |       | | |     |           | |   \n | |   |       |         |   | |   |   |       | | | | |                   |           |     | |   |   |             |                     |     |         |     |   |       | | |     |           | |   \n | |   |       +-+   +-------|---------------+ | | | | |                   |           |     | |   +-+ |             |             +-----------------------|-----------------|---------|-+         | |   \n | |   |         |   |   |   | |   |   |     | | | | | |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |   \n | +---|-+     +-+   |   |   | | +-|-----+   | | +-|-+ |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |   \n |     | |     |     |   |   | | | |   | |   | |   |   |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |   \n |     | |     +-----|-------|-----|---|-|---|-|---------------------------------------------|-|-----------------------------------|-------|-------------------------+       | | |     +-+         | |   \n |     | |           |   |   | | | |   | |   | |   |   |                   |           |     | |     | |             |             |       |     G         |     |           | | |                 | |   \n |     | |     +-----|-+ | +-|-|---------|---|-----|---|-------------------------------|-------------|-|-----+       |     +---------------------|-----------------------------|-|-----------------+ |   \n |     | |     |     | | | | | | | |   | |   | |   |   |                   |           |     | |     | |     |       |     |       |       |     |         |     |           | | |                   |   \n |     | |     | +-----|-|-|-----|-|---------------|-----------------------------------------|-------|---------------------|---------------------|---------|---------------+ | | |                   |   \n |     | |     | |   | | | | | | | |   | |   | |   |   |                   |           |     | |     | |     |       |     |       |       |     |         |     |         | | | |                   |   \n | +-------------------|-----|-|---------+   | |   |   | +-----------------------------|-----|-|-----|---------------------|---------------|---------------|-----|---------|-|-|-|-----+             |   \n | |   | |     | |   | | | | | | | |   |     | |   |   | |                 |           |     | |     | |     |       |     |       |       |     |         |     |         | | | |     |             |   \n | |   | |     | |   | | +---+ | +---------------------|-|---------------+ |           |     | |     | |     |       +-----|---------+     |     |       +-|-----|-----+   | | | |     |             |   \n | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           |     | |     | |     |             |       | |     |     |       | |     |     |   | | | |     |             |   \n | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           | +---|-|-------|-----|-------------|-------|-------------+   +-+ | +-----|---------+ | | |     |             |   \n | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           | |   | |     | |     |             |       | |     |         | | |       |     |     | | |     |             |   \n | |   | |     | |   | |   |   |   | +-------|---------|-|---------------|-------------+ |   | |     | |     |     +-------|-------------+ +---------+ | |       |     |     +-------+ |             |   \n | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |       | |   |             | |       |     |       | |   | |             |   \n | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |     +-----------------------|-------|-----+       | |   | |             |   \n | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |     | | |   |             | |       |             | |   | |             |   \n | |   | |     | |   | |   |   | +---+ |     | |   |   | |               | | +-----------|-----------|-----+ |     |       |     +---|---|-------------|-|------------------P----|-+ | |             |   \n | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |       |       | |   |             | |       |             | | | | |             |   \n | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |     +-+       | |   | +---+       | |       |             | | | | |             |   \n | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |   \n | |   | |     | |   | | +-------------------|-|-----------------------+ | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |   \n | |   | |     | |   | | | |   | | |   |     | |   |   | |             | | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |   \n | | +---|-----|-------|-|-|-----|-+   |     | |   | +---|-------------------------------|---+ |     | |   | |     |     |         | |   | |   |       | | +---------------------|-----|---+         |   \n | | | | |     | |   | | | |   | |     |     | |   | | | |             | | | |           |     |     | |   | |     |     |         | |   | |   |       | | |     |             | | | | |   |         |   \n | | | | |     | +-------------|-|-----------|-|-----|-----------------|---|-|-----------|-----------|-+   | |     |     |         | +---|-----|-----------------------+       | | | | |   |         |   \n | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |   \n | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |   \n | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |   \n | | | | |     |     | | | |   | |     |     | +---+ | | |             | | | |           |     |     |     | |     |     |         |     | | +-|-------|-|-|-----|-------------|-----+ |   | +---+   |   \n | | | | |     |     | | | |   | |     |     |       | | |             | | | |           |     |     |     | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |   \n | | | | |     |     | | | |   | |     |     |       | | |       +-----|-|---|-----------|-----|-------+   | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |   \n | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |           |     |     | |   | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |   \n | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       +-+ |     |   +-|-+   | |     |     |         |     | | | |       | | |     |     |   +---|---|---|---|-|---|-+ |   \n | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | |   \n | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | |   \n | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | R   \n | | | +-------|-----|-|-|-|-----|-----|---------------|-----------------|-|-------------------|---|---------|-----------|-------------------|-----+   | | |     |     |   |   | | |   |   | |   | | |   \n | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   |   | |   | | |   \n | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | +---|---|---|-+ \n | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | | \n | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | | \n | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | | \n | | +-----------+   | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   | +-----------|---------+   | | |   | | | |   | | | | \n | |     |     | |   | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | | \n | |     |     | |   | | | |   | |     |   +-|---------|-|---------------|-----------|---+     |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | | \n | |     |     | |   | | | |   | |     |   | |       | | |       |     | | | |       | |       |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | | \n | |     |     | | +-|-----|-----|---------|-----------|---------------|-|-----------|---------------+ +---|-----------------------|-----|-|-|-|-----|-----|---+ |     |       | | |   | | | |   | | | | \n | |     |     | | | | | | |   | |     |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | | \n | |     |     | | | | | | | +-|-----+ |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | +---|-|-----+     |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | | \n | |     |     | | | | | | | | +-------|---|---------|---|-------|-----|-|-|-------------------|---|-------+ |     |     |         |     | | | |   |   | | |   |       |     +-|-------|-|---|-+ | | | | \n | |     |     | | | | | | | |   |   | |   | |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |     | | | |   | | | | | | | | | \n | |     |     | | | | | | | |   | +-|-|---+ |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |     +-|-|---+ | | | | | | | | | \n | |     |     | | | | | | | |   | | | |     |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |       | | | | | | | | | | | | | \n | | +---|-----|-|-----|-|-----------|---------------+ | |       |     | | | |       | |       |   |   |     +-----------|-----------------|-|-|---|---|-|-----------+ |       | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | | | |     |         | |       |     | | | |       | |       |   E   |           |     |         |     | | | |   |   | | |   |     | |       | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | | +-|-----|---------|-|-------------|-|-------------|-------|---|-------+       |     | +-------|-+   | | | |   |   | | |   | +---|-|-----+ | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | | \n | | |   |     | | | | | | | |   | |   +---------------|-|-------|---+ | | | |       | |       |   |   |   |       |     | |       | | +---|-|-|---|-----|-|-----|---|-----------------|-|-|-|-|-|-+ | | \n | | |   |     | | | | | | | |   | |         |         | |       |   | | | | |       | |       |   |   |   |       |     | |       | | | | | | |   |   | | |   | |   | |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |   +-|---------|---------|-|-------|---|-|---------------|-------|---|---------------|-----+ |       | | | | | | |   |   | | |   +-|-+ | |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |     |         |         | |       |   | | | | |       | |       |   |   |   |       |       |       | | | | | | |   |   | | |     | | | |     | | | | | | | | | | |   | | \n | | |   | +---|-|-|---------------+ +-------|-+       | |       |   | | | | |       | | +-----|---|---------------|-----+ |       | | | | | | |   +---------+   | | | |     | | | | | | | | | | |   | | \n | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |       | | | |   | | | |     | | | | | | | | | | |   | | \n | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     +---|---|-+ | | | |     | | | | | | | | | | |   | | \n | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     | | | | | | | | | |     | | | | | | | | | | |   | | \n | | |   | |   | | | | | | | |       |       | |       | |       | +---|---------------|-----------|---|-------------------|-------|-|-|-------------|---|-+ | | | | | |     | | | | | | | | | | |   | | \n | | |   | |   | | | | | | | |       |       | |       | |       | | | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | | \n | | | +-|-|---|-|-|-|-|-----|-----------------|---------|-------|---|-|---|---------|---------|---|---+   |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | | \n | | | | | |   | | | | | | | |       |       | |       | |       | | | | | | |       | | |     |   |       |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | | \n | | | +---+   | | | | | | | |       |       | |       | +-------|---|-|-------------|---|-------------------------|-----|-|-------|-|---|-|---|-------|---------|---+ |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |       | | | | | | |     | | |   | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |       +-|-|-|-----|----V|-|---+ | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | | +-|---|---------|-----+   |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | |   | | | |       | | | |   |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | | \n | | |   |     | | | | | | | |       |       | |       |         | |   | +-|-|-------------|---|-----------|-----------------------------|-|-------+ | +-|---|-+ | |   |     | | +---|-|-------|---+ | | \n | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | +-------|-|---|---|-|-------|---|---------|-------|-------|-----------------|---------|---|-+   | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | |       | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | |       | |   | +---|-----------|---------+       |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | | \n | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | | \n | +-------------------|-|-|-----------------|-|-------|-|-------|-|---|-|-|---------|---------|-----------|-------|-----------------|-|-|-----------------|-|---|-----------|-|-----|---|---|-|-+ | | | \n |   |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |     | | | | | | | |   +-----------|---------+ |       | |   | | | +-----------|-|---------------|-------|-----+ |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |     | | | | | | | |   |   |       | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |   +-------|-|-+ | |   | +-+       | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |   +---|-+     |         | +-|-|---|---|---------------|---------------|-----+ | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |   |   | |     |         |   | | | |   |     | | |   | |   |     | |   | | |   | | |   | | | \n |   |   |   | | | | | |   | |   | |         | |       +---------|-|---|---|---------------|---|---------------|---|-+     |         |   | | | |   |     | +-|---|-|-----------|---|-|-----------+ | | | \n |   |   |   | | | | | |   | |   | |         | |       | |       | |   | | |         | | | |   |           |   |   |       |         |   | | | |   |     |   |   | |   |     | |   | | |   | | | | | | | \n +---------------------|-----|-----------------|-------|-|---------|-------|-----------|-|-|---|-----------|A--|-------------------------|-|-|-|---------|-------|-----|-----|-----|---+   | | +-|-----+ \n     |   |   | | | | | |   | |   | |         | |       | |       | |   | | |         | | | |   |           |   |   |       |         |   | | | |   |     |   |   | |   |     | |   | |     | |   | | |   \n +---|----M--|-|---|---|---|-------|---------|-----------|-------|-----+ | |         | | | |   |           |   |   |       |         |   | | | +---|---------------|---------|-|---|-|-----|-----+ | |   \n |   |   |   | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |     | |   \n +---+   | +-|-|-|-|-|-|-----------|-----------|-------|-|---------------|-----------|-----|---|-----------|---|---|-------|---------|---|---------------|---|---|-----|-----|-----|-|-----|-|-------|-+ \n         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |     | | | \n         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   +-+ | | \n         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | | \n         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | | \n         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | | \n         | | | | | | | +-----|-----------------|-----------------|-------------------|-|-|-|---------------|---------------------------------------|---------|-----|-----------|---+ |     | |   |   | | \n         | | | | | | |     | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |     |     | |   |   | | \n         | | | | | | |     | |   +-|---------|---------|---------------------------------|-----|-------------------------------------+ +---|-|-----+   +-|---|---------|-----|---------------|---+   | | \n         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | | \n         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | | \n         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | | \n         | | | | | +-|-----|-------+         | |       | +-------|---------|-----------|-----------------------|-----------------------------|---------|-----|---|-|---------|-|-----|---------------|-+ \n         | | | | |   |     | |               | |       |         | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |   \n         | | | | |   |     | |               | |       |         | |   +-+ |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |   \n         | | | | |   |     | |               | |       |         | |   |   |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |   \n         | | | | |   +-----|----Y------------------+   |         | |   |   |         | | | |   |           |   +-------------+         | | | |         | |   | +-|-+   |     | |     |     | |       |   \n         | | | | |         | |               | |   |   |         | |   |   |         | | | |   |           |       |       | |         | | | |         | |   | | |     |     | |     |     | |       |   \n         | | | | |         | |               +-|---|-------------|---+ |   |         | | | |   |           |       |       | +---------|-----------------|-----+ |     |     | |     |     | |       |   \n         | | | | |         | |                 |   |   |         | | | |   |         | | | |   |           |       |       |           | | | |         | |   |   |     |     | |     |     | |       |   \n         | | | | |         | |     +-----------|---|-----------------|-|-------------|-|-|-|---|-----------|-------|-------+           | | | |         | |   |   |     |     | |     |     | |       |   \n         | | | | |         | |     |           |   |   |         | | | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       |   \n         | | | | |         | |     |           |   |   |         | +---|---|-------------------|-----------|-------|-------------------|-|---|-----------|-------|-------------------|-------|-------|-+ \n         | | | | |         | |     |           |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | | \n         | | | +-------------------+           |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | | \n         | | |   |         | |                 |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | | \n         | | |   |   +-------|-----+           |   |   |         +---|-----------------|-|-----+           |       +-+                 | | | |         | |   |   |     |     | |     +---+ | |       | | \n         | | |   |   |     | |     |           |   |   |             | |   |         | | | |               |         |                 | | | |         | |   |   |     |     | |         | | |       | | \n         | +-|---|-------------------------------------+             | |   |         | | | |               |         +-------------------|---|-----------|---|---|-----|-------|-----------|-|-------+ | \n         |   |   |   |     | |     |           |   |                 | |   |         | | | |               |                           | | | |         | |   |   |     |     | |         | | |         | \n     +---|-----+ |   |     | |     |           |   |                 | |   |         | | | |               |                           +-|-------------|-|---|---+     +-----+ |         | | |         | \n     |   |   | | |   |     | |     |           |   |                 | |   |         | | | |               |                             | | |         | |   |                 |         | | |         | \n     |   |   | | |   |     | |     |           |   |                 | |   |         | | | | +-------------|---------+                   | | |         | |   |                 |         | | |         | \n     |   |   | | |   |     | |     |           |   |                 | |   |         | | | | |             |         |                   | | |         | |   |                 |         | | |         | \n     |   |   | | |   |     | |   +-----------------|-------------------+   |         | | | | |             |         +-------------------|-------------|-|---------------------|---------+ | |         | \n     |   |   | | |   |     | |   | |           |   |                 |     |         | | | | |             |                             | | |         | |   |                 |           | |         | \n     |   |   | | |   |     | |   | |           +---|-----------------|-----|-----------|-|-|-+             |                             | | |         | |   |                 |           | |         | \n     |   |   | | |   |     | |   | |               |                 |     |         | | | |               |                             | | |         | |   |                 |           | |         | \n     |   |   | | |   |     | |   | |               |                 |     |         +---------------------------------------------------+ | |         | | +-|-----------------|-----------|-|---------+ \n     |   |   | | |   |     | |   | |               |                 |     |           | | |               |                               | |         | | | |                 |           | |           \n     |   |   | | |   |     | |   | |               |                 |     |           | | |           +---|-------------------------------|-|---------|-|---------------------+           | |   +-+     \n     |   |   | | |   |     | |   | |               |                 |     |           | | |           |   |                               | |         | | | |                             | |   | |     \n +---|---|-------+   |     | |   | +---------------------------------|-----|-----------+ | |           |   |                               +-----------|-|---------------------------------|-+   | |     \n |   |   |   | |     |     | |   |                 |                 |     |             | |           |   |                                 |         | | | |                             |     | |     \n |   |   |   +-+     |     +-|---|-----------------|-----------------------------------------------------------------------------------------------------|---|-----------------------------+     | |     \n |   |   |           |       |   |                 |                 |     |             | |           |   |                                 |         | | | |                                   | |     \n +---+   |           |       |   |                 |                 +-------------------|-----------------|-------------------------------------------|---+ +-------------------------------------+     \n         |           |       |   |                 |                       |             | |           |   |                                 |         | |                                       |       \n +---+   |   +-------|-------|---|-+               |                       |             | +---------------|---------------------------------|---------|-|-----------------------------------+   |       \n |   |   |   |       |       |   | |               |                       |             |             |   |                                 |         | |                                   |   |       \n +---|---------------|-------|---|-----------------|-----------------------|-------------|-------------|---|---------------------------------|---------+ |                                   |   |       \n     |   |   |       |       |   | |               |                       |             |             |   |                                 |           |                                   |   |       \n     |   |   |       |       |   +-----+           |                       |             |             +---|-+                               +-----------+                                   |   |       \n     |   |   |       |       |     |   |           |                       |             |                 | |                                                                               |   |       \n     +---|---+       +-------+     +---+           |                       +-------------|-----------------+ +---------------------------------------------------+                           +---+       \n         |                                         |                                     |                                                                       |                                       \n         +-----------------------------------------+                                     +-----------------------------------------------------------------------+                                       \n                                                                                                                                                                                                         "
  val testInput = "     |          \n     |  +--+    \n     A  |  C    \n F---|----E|--+ \n     |  |  |  D \n     +B-+  +--+ "

  def parseInput(str: String): Array[Array[Char]] = {
    str.split("\n").map(s => s.toCharArray).toArray
  }

  def findStart(N: Array[Array[Char]]): (Int,Int) = {
    (0,N(0).indexOf('|'))
  }

  def step(N: Array[Array[Char]], S: State): Unit = {
    val c = get(N, S.pos)
    //println(c)
    c match {
      case ' ' => println("arghh"); S.done = true
      case '|' => // could check direction
      case '-' => // could check direction
      case '+' => {
        val newD = candidates(N, S.pos).diff(List(S.dir.oposite))
        if(newD.isEmpty) {
          S.done = true
        } else {
          S.dir = newD.head
        }
      }
      case _ => S.letters += c
    }
    S.pos = S.dir.step(S.pos)
  }

  def get(N: Array[Array[Char]], p: (Int,Int)): Char = {
    if(p._1 < 0 | p._2 < 0 || p._1 >= N.size || p._2 >= N(p._1).size ) {
      ' '
    } else {
      N(p._1)(p._2)
    }
  }

  def candidates(array: Array[Array[Char]], t: (Int, Int)) : List[PipeDirection] = {
    List(PN,PE,PS,PW).filter(d => get(array,d.step(t)) != ' ')
  }

  def main(args: Array[String]): Unit = {
    var N = parseInput(input)

    println(N.map(r => r.mkString).mkString("\n"))
    var state = new State(findStart(N))

    var steps = 0
    while(!state.done) {
      step(N, state)
      steps += 1
      //println(state)
      //exit -= 1
    }
    println(state)
    println(steps -1)

  }

}
